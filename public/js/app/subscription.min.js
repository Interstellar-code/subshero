$(document).ready(function(){app.register("subscription",new clsApp_Subscription)});class clsApp_Subscription{_form_add="#frm_subscription_add";_form_quick_add="#frm_main_quick_add";_form_edit="#frm_subscription_edit";image="#subscription_add_image";img_add;img_edit;img_clone;pdf_invoice_add;e={add:{modal:"#modal_subscription_add",form:"#frm_subscription_add",folder:"#subscription_add_folder_id",brand_id:"#subscription_add_brand_id",type:"#subscription_add_type",frequency:"#subscription_add_billing_frequency",cycle:"#subscription_add_billing_cycle",recurring:"#subscription_add_recurring",recurring_toggle:"#subscription_add_recurring_toggle_container",status_toggle:"#subscription_add_status_toggle_container",billing_container:"#subscription_add_billing_container",billing_type:'#frm_subscription_add input[name="billing_type"]',tags:"#frm_subscription_add #subscription_add_tags"},add_quick:{modal:"#modal_subscription_quick_add",form:"#frm_main_quick_add",brand_id:"#main_quick_add_brand_id",type:"#main_quick_add_type",frequency:"#main_quick_add_billing_frequency",cycle:"#main_quick_add_billing_cycle",recurring:"#main_quick_add_recurring",recurring_toggle:"#main_quick_add_recurring_toggle_container",status_toggle:"#main_quick_add_status_toggle_container",billing_container:"#main_quick_add_billing_container",billing_type:'#frm_main_quick_add input[name="billing_type"]'},invoice_parse:{modal:"#modal_subscription_invoice_parse",form:"#frm_main_invoice_parse",status_toggle:"#subscription_invoice_parse_status_toggle_container"},edit:{modal:"#modal_subscription_edit",form:"#frm_subscription_edit",brand_id:"#subscription_edit_brand_id",type:"#subscription_edit_type",frequency:"#subscription_edit_billing_frequency",cycle:"#subscription_edit_billing_cycle",recurring:"#subscription_edit_recurring",recurring_toggle:"#subscription_edit_recurring_toggle",recurring_toggle_container:"#subscription_edit_recurring_toggle_container",status_toggle:"#subscription_edit_status_toggle_container",billing_container:"#subscription_edit_billing_container",billing_type:'#frm_subscription_edit input[name="billing_type"]'},clone:{modal:"#modal_subscription_clone",form:"#frm_subscription_clone",brand_id:"#subscription_clone_brand_id",type:"#subscription_clone_type",frequency:"#subscription_clone_billing_frequency",cycle:"#subscription_clone_billing_cycle",recurring:"#subscription_clone_recurring",recurring_toggle:"#subscription_clone_recurring_toggle",recurring_toggle_container:"#subscription_clone_recurring_toggle_container",status_toggle:"#subscription_clone_status_toggle_container",billing_container:"#subscription_clone_billing_container",billing_type:'#frm_subscription_clone input[name="billing_type"]'},addon:{form:"#frm_subscription_addon",type:"#subscription_addon_type",frequency:"#subscription_addon_billing_frequency",cycle:"#subscription_addon_billing_cycle",recurring:"#subscription_addon_recurring",recurring_toggle:"#subscription_addon_recurring_toggle",recurring_toggle_container:"#subscription_addon_recurring_toggle_container",status_toggle:"#subscription_addon_status_toggle_container",billing_container:"#subscription_addon_billing_container",billing_type:'#frm_subscription_addon input[name="billing_type"]'},attachment:{form:"#frm_subscription_attachment",type:"#subscription_attachment_type",frequency:"#subscription_attachment_billing_frequency",cycle:"#subscription_attachment_billing_cycle",recurring:"#subscription_attachment_recurring",recurring_toggle:"#subscription_attachment_recurring_toggle",recurring_toggle_container:"#subscription_attachment_recurring_toggle_container",status_toggle:"#subscription_attachment_status_toggle_container",billing_container:"#subscription_attachment_billing_container",billing_type:'#frm_subscription_attachment input[name="billing_type"]',filepond:"#subscription_attachment_image_file",modal:"#modal_subscription_attachment",list:"#modal_subscription_attachment table tbody",template:"#tpl_subscription_attachment_row"},container:"#folder_container",subscription:{chart:"#subscription_chart_subs"},lifetime:{chart:"#subscription_chart_ltd"},koolreport:{area_chart:"#koolreport_subscription_area_chart",drilldown:"#koolreport_subscription_drilldown"},chart:{subscription_total_count:"#subscription_total_count",subscription_active_count:"#subscription_active_count",subscription_monthly_price:"#subscription_monthly_price",subscription_total_price:"#subscription_total_price",lifetime_total_count:"#lifetime_total_count",lifetime_active_count:"#lifetime_active_count",lifetime_this_year_price:"#lifetime_this_year_price",lifetime_total_price:"#lifetime_total_price"},select2:{brand_id:"#tpl_select2_favicon"}};d={subscription:{chart:{series:[{name:lang("Subscription"),data:{}}],chart:{type:"area",height:250,zoom:{enabled:!1},toolbar:{show:!1}},colors:["#f9c916"],dataLabels:{enabled:!1},stroke:{curve:"smooth"},labels:{},xaxis:{type:"month"},yaxis:{opposite:!0},legend:{horizontalAlign:"left"}}},lifetime:{chart:{series:[{name:lang("LTD"),data:{}}],chart:{type:"area",height:250,zoom:{enabled:!1},toolbar:{show:!1}},colors:["#004547"],dataLabels:{enabled:!1},stroke:{curve:"smooth"},labels:{},xaxis:{type:"month"},yaxis:{opposite:!0},legend:{horizontalAlign:"left"}}}};o={billing_frequency:null,billing_cycle:null,currency_code:null,payment_mode:null,subscription:{chart:{config:null,data:null,instance:null},area_chart:null,table:null},lifetime:{chart:{config:null,data:null,instance:null},drilldown:null},area_chart:null,drilldown:null,attachment:{filepond:null,files:[],data_id:null},ajax:{current_request:null},select2:{selection:null},add:{select2:{brand_id:null}},add_quick:{select2:{brand_id:null}},edit:{select2:{brand_id:null}},clone:{select2:{brand_id:null}}};c={select2:{product:{tags:!0,theme:"bootstrap4",dropdownParent:$("#modal_subscription_add"),placeholder:{id:"",text:app.lang["None Selected"]},insertTag:function(e,i){isNaN(i.text)&&e.push(i)},ajax:{url:function(e){return e.term?app.url+"select2/product/search/"+e.term:app.url+"select2/product/search/"},processResults:function(e){return{results:e}}},templateResult:function(e){let i="";if(void 0!==e.pricing_type)i=$(app.subscription.t.select2.get_brand_id(e.id,e.pricing_type,e.product_name,e.favicon));else{if(e.loading)return e.text;i=$(app.subscription.t.select2.get_brand_id_new_item(e.text))}return i},templateSelection:function(e){return void 0!==e.pricing_type?e.product_name:e.text}}}};f={area_chart_tooltip_label:function(e,i){e=e.index,e=app.subscription.o.subscription.area_chart[e];return void 0!==e?e.product_name+" • "+app.subscription.get_billing_cycle(e.billing_cycle):null},lifetime:{drilldown_tooltip_label:function(e,i){var t=e.index,t=app.subscription.o.lifetime.drilldown[t];return void 0!==t?void 0===t.product_name?"$"+e.value:t.product_name+" • $"+e.value:null}}};t={history:{table:{action:$("#tpl_subscription_history_action_column").html(),get_action:function(e){return app.subscription.t.history.table.action.replace(/__ID__/g,e)},payment_date:$("#tpl_subscription_history_payment_date_column").html(),get_payment_date:function(e){e=new Date(e).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});return app.subscription.t.history.table.payment_date.replace(/__DATE__/g,e)},payment_method:$("#tpl_subscription_history_payment_method_column").html(),get_payment_method:function(e){return app.subscription.t.history.table.payment_method.replace(/__PAYMENT_METHOD_NAME__/g,e)}}},select2:{brand_id:$("#tpl_select2_subscription_brand_id").html(),get_brand_id:function(e,i,t,a){let n="",p="";return i&&(1==i?(n="Sub",p="warning"):3==i&&(n="LTD",p="info")),app.subscription.t.select2.brand_id.replace(/__ITEM_ID__/g,e).replace(/__ITEM_TYPE__/g,n).replace(/__ITEM_TYPE_CLASS__/g,p).replace(/__ITEM_PRODUCT_NAME__/g,t).replace(/__ITEM_FAVICON_SRC__/g,a)},brand_id_selection:$("#tpl_select2_subscription_brand_id_selection").html(),get_brand_id_selection:function(e,i,t){return app.subscription.t.select2.brand_id_selection.replace(/__ITEM_ID__/g,e).replace(/__ITEM_PRODUCT_NAME__/g,i).replace(/__ITEM_FAVICON_SRC__/g,t)},brand_id_new_item:$("#tpl_select2_subscription_brand_id_new").html(),get_brand_id_new_item:function(e){return app.subscription.t.select2.brand_id_new_item.replace(/__ITEM_TEXT__/g,e)}}};constructor(){}get_billing_cycle(e){return 1==e?"Daily":2==e?"Weekly":3===e?"Monthly":4===e?"Yearly":e}get_drilldown_tooltip(){let i=new FormData;i.append("_token",app.config.token),setTimeout(function(){var e=setInterval(function(){$.active<=0&&(clearInterval(e),$.ajax({url:app.url+"koolreport/subscription/get_drilldown_tooltip",type:"POST",data:i,dataType:"json",beforeSend:function(e){},success:function(e){app.subscription.o.subscription.drilldown=e},error:function(e){app.alert.response(e)},complete:function(){},processData:!1,contentType:!1}))},100)},100)}init(){this.img_add&&(this.img_add.destroy(),this.img_add.destroy=null),this.pdf_invoice_add&&(this.pdf_invoice_add.destroy(),this.pdf_invoice_add.destroy=null),lib.sleep(100).then(function(){app.subscription.img_add=lib.img.filepond("#subscription_add_image_file"),app.subscription.pdf_invoice_add=lib.img.filepond("#subscription_invoice_file",{labelIdle:'<p class="subscription_invoice_big_title"><img src="/assets/icons/invoice_parsing/invoice.svg" class="subscription_invoice_icon m-2"/>Drop Invoices Here or Click to Upload</p><p>Allowed file types: pdf</p>',imagePreviewHeight:600,imageCropAspectRatio:"1:1",imageResizeTargetWidth:600,imageResizeTargetHeight:600,stylePanelLayout:"integrated",styleLoadIndicatorPosition:"center bottom",styleButtonRemoveItemPosition:"center bottom"}),app.subscription.pdf_invoice_add&&(app.subscription.pdf_invoice_add.onaddfile=function(e,i){e?console.log("error",e):(e=new FormData($(app.subscription.e.invoice_parse.form)[0]),i&&i.file&&e.append("file",i.file),$("#subscription_invoice_load_msg").show(),$.ajax({url:$(app.subscription.e.invoice_parse.form).attr("action"),type:"POST",data:e,dataType:"json",success:function(e){console.log(e),$("#subscription_invoice_load_msg").hide(),app.subscription.pdf_invoice_add.removeFiles(),$(app.subscription.e.invoice_parse.form).hide(),$("#subscription_invoice_preview_table").show(),subscription_invoice_make_table(e)},error:function(e){console.log(e),$("#subscription_invoice_load_msg").hide(),app.subscription.pdf_invoice_add.removeFiles(),$(app.subscription.e.invoice_parse.form).hide(),$("#subscription_invoice_preview_table").show()},processData:!1,contentType:!1}))}),app.subscription.img_add&&app.subscription.img_add.on("removefile",app.subscription.img_add_on_addfile)}),$("#modal_subscription_add .select2_init_tags").select2({tags:!0,theme:"bootstrap4",dropdownParent:$("#modal_subscription_add"),placeholder:{id:"",text:app.lang["None Selected"]},insertTag:function(e,i){isNaN(i.text)&&e.push(i)}}),$("#modal_subscription_add .select2_init_multi").select2({tags:!0,theme:"bootstrap4",dropdownParent:$("#modal_subscription_add"),insertTag:function(e,i){isNaN(i.text)&&e.push(i)}}),$("#modal_subscription_quick_add .select2_init_tags").select2({tags:!0,theme:"bootstrap4",dropdownParent:$("#modal_subscription_quick_add"),placeholder:{id:"",text:app.lang["None Selected"]}}),$("#subscription_add_category_id").select2({tags:!1,theme:"bootstrap4",dropdownParent:$("#modal_subscription_add"),dropdownCssClass:"select2_search_below"}),$(".bars-movie").barrating("clear"),$(".bars-movie").barrating("set",0),$(app.subscription.e.add.tags).select2({tags:!0,theme:"bootstrap4",dropdownParent:$("#modal_subscription_add"),dropdownCssClass:"select2_search_below",maximumSelectionLength:10,ajax:{url:app.url+"settings/tag/search/",data:function(e){return{q:e.term}},processResults:function(e){let i=[];return e.forEach(e=>{e.text=e.name,i.push(e)}),{results:i}}}}),$(app.subscription.e.add.folder).select2({tags:!0,theme:"bootstrap4",dropdownParent:$("#modal_subscription_add"),ajax:{url:app.url+"folder/search",data:function(e){return{q:e.term}},processResults:function(e){let i=[];return e.forEach(e=>{e.text=`${e.name} <span class="badge badge_recurring">${e.currency_symbol}</span>`,i.push(e)}),{results:i}}},templateResult:function(e){return e.name?(e.currency_symbol||(e.currency_symbol="All"),`${e.name} <span class="badge badge_recurring">${e.currency_symbol}</span>`):e.text},escapeMarkup:function(e){return e},templateSelection:function(e){var i;return e.text.includes("<span")&&e.text.includes("</span>")||(i=e.text.split(" ")).length<2?e.text:(e=i.pop(),i.join(" ")+` <span class="badge badge_recurring">${e}</span>`)}}),app.subscription.o.add.select2.brand_id=app.subscription.c.select2.product,app.subscription.o.add.select2.brand_id.dropdownParent=$(app.subscription.e.add.modal),$(app.subscription.e.add.brand_id).select2(app.subscription.o.add.select2.brand_id),$(app.subscription.e.add.brand_id).on("select2:select",function(t){app.subscription.o.select2.selection||t.params.data&&(lib.sleep(100).then(()=>{let i=t.params.data.image_path;app.subscription.img_add.destroy(),app.subscription.img_add=null,$("#subscription_add_image_path").val(""),$("#subscription_add_company_type").val(t.params.data.product_type),$("#subscription_add_description").val(t.params.data.description),$("#subscription_add_price").val(t.params.data.price1_value),$("#subscription_add_price_type").val(t.params.data.currency_code),$("#subscription_add_url").val(t.params.data.url),$("#subscription_add_billing_frequency").val(t.params.data.billing_frequency),$("#subscription_add_billing_cycle").val(t.params.data.billing_cycle),$("#subscription_add_type").val(t.params.data.pricing_type),$("#subscription_add_category_id").val(t.params.data.category_id).trigger("change"),$("#subscription_add_ltdval_price").val(t.params.data.ltdval_price),$("#subscription_add_ltdval_cycle").val(t.params.data.ltdval_cycle),$("#subscription_add_ltdval_frequency").val(t.params.data.ltdval_frequency),$("#subscription_add_refund_days").val(t.params.data.refund_days);var e=parseInt(t.params.data.refund_days);if(0<e?$("#subscription_add_refund_days").val(e):$("#subscription_add_refund_days").val(""),app.subscription.create_type_check("#subscription_add_type"),app.subscription.create_recurring_check($("#subscription_add_recurring")[0]),""!=t.params.data.favicon?$("#modal_subscription_add .modal-header img.favicon").attr("src",t.params.data.favicon):app.ui.modal_favicon(t.params.data.url,"#modal_subscription_add .modal-header img.favicon"),app.subscription.modal_title_change("create"),i){let e=Object.assign({},app.global.filepond_options);e.files=[{source:btoa(i),options:{type:"local"}}],lib.sleep(100).then(function(){$("#subscription_add_image_path").val(i),app.subscription.img_add=lib.img.filepond("#subscription_add_image_file",e),$("#subscription_add_img_path_or_file").val(0),app.subscription.img_add.on("removefile",app.subscription.img_add_on_addfile)})}else lib.sleep(100).then(function(){app.subscription.img_add=lib.img.filepond("#subscription_add_image_file"),app.subscription.img_add.on("removefile",app.subscription.img_add_on_addfile),$("#subscription_add_img_path_or_file").val(1)}),t.params.data.billing_frequency||$("#subscription_add_billing_frequency").val(app.subscription.o.billing_frequency),t.params.data.billing_cycle||$("#subscription_add_billing_cycle").val(app.subscription.o.billing_cycle),t.params.data.currency_code||$("#subscription_add_price_type").val(app.subscription.o.currency_code);app.subscription.o.select2.selection=!1}),app.subscription.o.select2.selection=!0)}),app.subscription.o.add_quick.select2.brand_id=app.subscription.c.select2.product,app.subscription.o.add_quick.select2.brand_id.dropdownParent=$(app.subscription.e.add_quick.modal),$(app.subscription.e.add_quick.brand_id).select2(app.subscription.o.add_quick.select2.brand_id),$(app.subscription.e.add_quick.brand_id).on("select2:select",function(t){app.subscription.o.select2.selection||t.params.data&&(lib.sleep(100).then(()=>{var e=t.params.data.image_path,i=($("#main_quick_add_description").val(t.params.data.description),$("#main_quick_add_price").val(t.params.data.price1_value),$("#main_quick_add_price_type").val(t.params.data.currency_code),$("#main_quick_add_url").val(t.params.data.url),$("#main_quick_add_billing_frequency").val(t.params.data.billing_frequency),$("#main_quick_add_billing_cycle").val(t.params.data.billing_cycle),$("#main_quick_add_type").val(t.params.data.pricing_type),parseInt(t.params.data.refund_days));0<i?$("#main_quick_add_refund_days").val(i):$("#main_quick_add_refund_days").val(""),app.subscription.create_quick_type_check("#main_quick_add_type"),app.subscription.modal_title_change("create_quick"),app.subscription.create_quick_recurring_check($("#main_quick_add_recurring")[0]),e||(t.params.data.billing_frequency||$("#main_quick_add_billing_frequency").val(app.subscription.o.billing_frequency),t.params.data.billing_cycle||$("#main_quick_add_billing_cycle").val(app.subscription.o.billing_cycle),t.params.data.currency_code)||$("#main_quick_add_price_type").val(app.subscription.o.currency_code),""!=t.params.data.favicon?$("#modal_subscription_quick_add .modal-header img.favicon").attr("src",t.params.data.favicon):app.ui.modal_favicon(t.params.data.url,"#modal_subscription_quick_add .modal-header img.favicon"),app.subscription.o.select2.selection=!1}),app.subscription.o.select2.selection=!0)});app.subscription.o.attachment.filepond=FilePond.create($(app.subscription.e.attachment.filepond)[0],{allowReorder:!0,allowImagePreview:!1,maxFileSize:"8MB",acceptedFileTypes:["image/*","application/pdf","text/csv"]}),app.subscription.o.attachment.filepond.onaddfile=function(e,i){console.log("error",e),console.log("addfile",i),null===e&&app.subscription.attachment_load_file(i)},app.subscription.koolreport_both_charts_load()}img_add_on_addfile(e,i){$("#subscription_add_img_path_or_file").val(1)}img_edit_on_addfile(e,i){$("#subscription_edit_img_path_or_file").val(1)}img_clone_on_addfile(e,i){$("#subscription_clone_img_path_or_file").val(1)}create(e){app.global.create({form:app.subscription._form_add,slug:"subscription/create",image:this.img_add.getFile()?this.img_add.getFile().file:null,btn:e,success:function(e){e.status?(app.alert.succ(e.message),app.subscription.reset_type_fields(),lib.sub.modal_subscription_add_done(),$(app.subscription._form_add)[0].reset(),app.subscription.img_add.removeFile(),app.subscription.init(),app.subscription.load_page(),app.folder.refresh()):app.alert.validation(e.message)}})}create_quick(e){app.global.create({form:app.subscription._form_quick_add,slug:"subscription/create_quick",btn:e,success:function(e){e.status?(app.alert.succ(e.message),app.subscription.reset_type_fields(),lib.sub.modal_subscription_quick_add_done(),$(app.subscription._form_quick_add)[0].reset(),app.subscription.init(),app.subscription.load_page()):app.alert.validation(e.message)}})}edit(i){var e=lib.get_id(i);if(!e)return!1;var t=new FormData;t.append("_token",app.config.token),t.append("id",e),$.ajax({url:app.url+"subscription/edit/"+e,type:"POST",data:t,beforeSend:function(e){app.loading.btn(i)},success:function(e){e&&($("#modal_subscription_edit .modal-body").html(e),$("#modal_subscription_edit").modal(),app.load.tooltip())},error:function(e){app.alert.response(e)},complete:function(){app.loading.btn(i)},processData:!1,contentType:!1})}update(e,i){app.global.create({form:app.subscription._form_edit,slug:"subscription/update/"+i,image:this.img_edit.getFile()?this.img_edit.getFile().file:null,btn:e,success:function(e){e.status?(app.alert.succ(e.message),app.subscription.reset_type_fields(),$("#modal_subscription_edit").modal("hide"),$(app.subscription._form_edit)[0].reset(),app.subscription.img_edit.removeFile(),app.subscription.init(),app.subscription.load_page(),app.folder.refresh()):app.alert.validation(e.message)}})}history_clear_item(e,i){delete(e={...e}).action;var t=parseInt(e.payment_method),a=(t?(a=document.wijmoApp._dataSvc.getPaymentMethods(),e.payment_method=a[t]):delete e.payment_method,wijmo.Globalize.parseDate(e.payment_date,"MMM d yyyy"));return a?e.payment_date=`${a.getFullYear()}-${a.getMonth()+1}-`+a.getDate():delete e.payment_date,i||delete e.id,e.subscription_id=$("#subscription_history_table_wijmo_grid").data("subscription_id"),e}history_save(e){var i=parseInt(e.dataset.id),e=($(e).hide(),$(e).parent().find("i").show(),document.wijmoApp._theGrid.collectionView),t={...e.currentItem},a=((t=this.history_clear_item(t,i))._token=app.config.token,new FormData);for(const n in t)a.append(n,t[n]);$.ajax({url:app.url+"subscription_history/update",type:"POST",data:a,dataType:"json",beforeSend:function(e){},success:function(e){var i,t;e.status?(t=(i=document.wijmoApp._theGrid.collectionView).items.length,(t=i.items[t-1]).id||(t.id=e.id,t.action=1,delete t.subscription_id,delete t._token),i.commitEdit(),document.wijmoApp._theGrid.collectionView.refresh(),app.alert.succ(e.message)):app.alert.validation(e.message)},error:function(e){app.alert.err(e.message)},complete:function(){},processData:!1,contentType:!1})}history_save_all(){let e=JSON.parse(JSON.stringify(document.wijmoApp._theGrid.collectionView._src));var i=e.map(e=>this.history_clear_item(e,parseInt(e.id??0))),i=(e=JSON.stringify(i),new FormData);i.append("_token",app.config.token),i.append("history_data",e),$.ajax({url:app.url+"subscription_history/update_all",type:"POST",data:i,dataType:"json",beforeSend:function(e){},success:function(e){var i;e.status?(app.alert.succ(e.message),i=$("#subscription_history_table_wijmo_grid").data("subscription_id"),$.ajax({url:app.url+"subscription_history/get/"+i,type:"GET",dataType:"json",success:function(e){var i=document.wijmoApp._theGrid.collectionView;i._src=e.subscription_history,i.refresh()}})):app.alert.validation(e.message)},error:function(e){app.alert.response(e)},complete:function(){},processData:!1,contentType:!1})}history_add(){var e=document.wijmoApp._theGrid.collectionView,i=e.addNew(),t=(i.id=0,document.wijmoApp._dataSvc._real_data.defaults);i.payment_date=t.payment_date,i.price=t.price,i.payment_method=t.payment_method,delete i.history,e.commitNew()}history_delete(e){var i=e.dataset.id,e=($(e).hide(),$(e).parent().find("i").show(),document.wijmoApp._theGrid.collectionView),t=(e.remove(e.currentItem),{id:i,_token:app.config.token}),a=new FormData;for(const n in t)a.append(n,t[n]);$.ajax({url:app.url+"subscription_history/delete",type:"POST",data:a,dataType:"json",beforeSend:function(e){},success:function(e){e.status?app.alert.succ(e.message):app.alert.validation(e.message)},error:function(e){app.alert.response(e)},complete:function(){},processData:!1,contentType:!1})}delete(i){let t=lib.get_id(i);if(!t)return!1;swal({title:"Are you sure?",text:"Once deleted, you will not be able to recover this!",icon:"warning",buttons:!0,dangerMode:!0}).then(e=>{e&&((e=new FormData).append("_token",app.config.token),e.append("id",t),$.ajax({url:app.url+"subscription/delete/"+t,type:"POST",data:e,dataType:"json",beforeSend:function(e){app.loading.btn(i)},success:function(e){e?($("#modal_subscription_edit").modal("hide"),$("#tbl_subscription").DataTable().ajax.reload(null,!1),app.alert.succ(e.message)):app.alert.warn(e.message)},error:function(e){app.alert.response(e)},complete:function(){app.loading.btn(i)},processData:!1,contentType:!1}))})}cancel(i){let t=lib.get_id(i);if(!t)return!1;swal({title:"Are you sure?",text:"Once canceled, you will not be able to activate this!",icon:"warning",buttons:!0,buttons:["Close","OK"],dangerMode:!0}).then(e=>{e&&((e=new FormData).append("_token",app.config.token),e.append("id",t),$.ajax({url:app.url+"subscription/cancel/"+t,type:"POST",data:e,dataType:"json",beforeSend:function(e){app.loading.btn(i)},success:function(e){e?($("#modal_subscription_edit").modal("hide"),$("#tbl_subscription").DataTable().ajax.reload(null,!1),app.alert.succ(e.message)):app.alert.warn(e.message)},error:function(e){app.alert.response(e)},complete:function(){app.loading.btn(i)},processData:!1,contentType:!1}))})}clone(i){var e=lib.get_id(i);if(!e)return!1;var t=new FormData;t.append("_token",app.config.token),t.append("id",e),$.ajax({url:app.url+"subscription/clone/"+e,type:"POST",data:t,beforeSend:function(e){app.loading.btn(i)},success:function(e){e&&($("#modal_subscription_clone .modal-body").html(e),$("#modal_subscription_clone").modal(),app.load.tooltip())},error:function(e){app.alert.response(e)},complete:function(){app.loading.btn(i)},processData:!1,contentType:!1})}addon(i){var e=lib.get_id(i);if(!e)return!1;var t=new FormData;t.append("_token",app.config.token),t.append("id",e),$.ajax({url:app.url+"subscription/addon/"+e,type:"POST",data:t,beforeSend:function(e){app.loading.btn(i)},success:function(e){e&&($("#modal_subscription_addon .modal-body").html(e),$("#modal_subscription_addon").modal(),app.load.tooltip())},error:function(e){app.alert.response(e)},complete:function(){app.loading.btn(i)},processData:!1,contentType:!1})}refund(i){let t=lib.get_id(i);if(!t)return!1;swal({title:"Are you sure?",text:"Once refunded, you will not be able to activate this!",icon:"warning",buttons:!0,dangerMode:!0}).then(e=>{e&&((e=new FormData).append("_token",app.config.token),e.append("id",t),$.ajax({url:app.url+"subscription/refund/"+t,type:"POST",data:e,dataType:"json",beforeSend:function(e){app.loading.btn(i)},success:function(e){e?($("#modal_subscription_edit").modal("hide"),$("#tbl_subscription").DataTable().ajax.reload(null,!1),app.alert.succ(e.message)):app.alert.warn(e.message)},error:function(e){app.alert.response(e)},complete:function(){app.loading.btn(i)},processData:!1,contentType:!1}))})}attachment(i){let t=lib.get_id(i);if(!t&&!(t=$(i).closest(".modal").find('form input[name="id"]').val()))return!1;$("#modal_subscription_edit").modal("hide");var e=new FormData;e.append("_token",app.config.token),e.append("id",t),$.ajax({url:app.url+"subscription/attachment/"+t,type:"POST",data:e,beforeSend:function(e){app.loading.btn(i)},success:function(e){e&&(app.subscription.o.attachment.data_id=t,$("#modal_subscription_attachment .modal-body .item_container").html(e),$("#modal_subscription_attachment").modal("show"),app.load.tooltip())},error:function(e){app.alert.response(e)},complete:function(){app.loading.btn(i)},processData:!1,contentType:!1})}attachment_load_file(){var e={};e.id="file_"+app.subscription.o.attachment.files.length,e.file=app.subscription.o.attachment.filepond.getFile().file,e.file=new File([app.subscription.o.attachment.filepond.getFile().file],e.file.name,{type:e.file.type}),app.subscription.o.attachment.filepond.removeFiles();let i=$(app.subscription.e.attachment.template).html();i=(i=(i=i.replace(/__FILE_ID__/g,e.id)).replace(/__FILE_NAME__/g,e.file.name)).replace(/__FILE_SIZE__/g,e.file.size),$(app.subscription.e.attachment.list).append(i),app.subscription.o.attachment.files.push(e),app.subscription.attachment_upload(e.id)}attachment_upload(e){if(e=isNaN(e)?parseInt(e.replace("file_","")):parseInt(e),void 0===app.subscription.o.attachment.files[e])return!1;let t=app.subscription.o.attachment.files[e];e=new FormData;e.append("_token",app.config.token),e.append("id",app.subscription.o.attachment.data_id),e.append("file",t.file),t.jqXHR=$.ajax({url:app.url+"subscription/attachment_upload/"+app.subscription.o.attachment.data_id,type:"POST",data:e,dataType:"json",beforeSend:function(e){app.load.tooltip(),app.subscription.attachment_progress(t.id,0),app.subscription.attachment_display(t.id,"uploading")},xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){e.lengthComputable&&(e=e.loaded/e.total,app.subscription.attachment_progress(t.id,e))},!1),e},success:function(e){var i;e.status?(app.subscription.attachment_display(t.id,"success"),0<(i=$(app.subscription.e.attachment.list).find('tr[data-id="'+t.id+'"]')).length&&e.data&&(i.find(".file_size").text(e.data.file_size),i.find(".action_buttons a.btn_view").attr("href",e.data.file_url),i.find(".action_buttons .btn_download").attr("onclick",`lib.do.download_file('${e.data.file_url}', '${e.data.file_name}', this);`),i.find(".action_buttons").show(),i.attr("data-id",e.data.id))):(app.alert.warn(e.message),app.subscription.attachment_display(t.id,"failed"))},error:function(e){},complete:function(){},processData:!1,contentType:!1})}attachment_display(e,i){e=$(app.subscription.e.attachment.list).find('tr[data-id="'+e+'"]');0<e.length&&("uploading"==i?(e.find(".btn_container .btn_cancel").show(),e.find(".btn_container .btn_retry").hide(),e.find(".file_size .progress").show(),e.find(".file_size .status_failed").hide()):"success"==i?(e.find(".btn_container .upload_buttons").remove(),e.find(".file_size").html(null)):"failed"==i&&(e.find(".btn_container .btn_retry").show(),e.find(".file_size .progress").hide(),e.find(".file_size .status_failed").show()))}attachment_progress(e,i){e=$(app.subscription.e.attachment.list).find('tr[data-id="'+e+'"] .progress-bar');0<e.length&&(i=Math.round(100*i),e.css("width",i+"%"),e.attr("aria-valuenow",i))}attachment_cancel(e){if(isNaN(e)){var i=parseInt(e.replace("file_",""));if(0<=i&&void 0!==app.subscription.o.attachment.files[i])return app.subscription.o.attachment.files[i].jqXHR.abort(),$(app.subscription.e.attachment.list).find('tr[data-id="'+e+'"]').remove(),app.load.tooltip(),!0}return!1}attachment_delete(i){let t=lib.get_id(i);if(!t)return!1;swal({title:"Are you sure?",text:"Once deleted, you will not be able to recover this!",icon:"warning",buttons:!0,dangerMode:!0}).then(e=>{e&&((e=new FormData).append("_token",app.config.token),e.append("id",t),$.ajax({url:app.url+"subscription/attachment_delete/"+t,type:"POST",data:e,dataType:"json",beforeSend:function(e){app.loading.btn(i)},success:function(e){e?($(app.subscription.e.attachment.list).find('tr[data-id="'+t+'"]').remove(),app.load.tooltip(),app.alert.succ(e.message)):app.alert.warn(e.message)},error:function(e){app.alert.response(e)},complete:function(){app.loading.btn(i)},processData:!1,contentType:!1}))})}clone_create(e){app.global.create({form:app.subscription.e.clone.form,slug:"subscription/create",image:this.img_clone.getFile()?this.img_clone.getFile().file:null,btn:e,success:function(e){e.status?(app.alert.succ(e.message),$("#modal_subscription_clone").modal("hide"),app.subscription.init(),$("#tbl_subscription").DataTable().ajax.reload(null,!1),app.folder.refresh()):app.alert.validation(e.message)}})}addon_create(e){app.global.create({form:app.subscription.e.addon.form,slug:"subscription/create",image:this.img_addon.getFile()?this.img_addon.getFile().file:null,btn:e,success:function(e){e.status?(app.alert.succ(e.message),$("#modal_subscription_addon").modal("hide"),app.subscription.init(),$("#tbl_subscription").DataTable().ajax.reload(null,!1),app.folder.refresh()):app.alert.validation(e.message)}})}get_by_folder(i){event&&event.preventDefault();let t=location.href.split("/");$("#folder_container .dropdown-item.active").removeClass("active"),$("#folder_container .dropdown-item[data-id="+i+"]").addClass("active");var e=new FormData;return e.append("_token",app.config.token),e.append("id",i),$.ajax({url:app.url+"folder/session/set",type:"POST",data:e,success:function(e){"calendar"==t[t.length-1]?(app.calendar.o.filter.folder_id=i,app.calendar.o.instance.render()):(app.calendar.o.filter.folder_id=null,app.page.switch("subscription"))},error:function(e){},complete:function(){},processData:!1,contentType:!1}),!0}filter_alert_profile(e,i){(e=$(e)).find("option").attr("disabled",!1),(3==i?e.find('option[data-alert_subs_type!="'+i+'"]'):e.find('option[data-alert_subs_type!="'+i+'"]:not(:first)')).attr("disabled",!0),e.find(":selected").data("alert_subs_type")!=i&&e.prop("selectedIndex",3==i?1:0),e.multiselect("refresh")}create_type_check(e){e=$(e).find(":selected").val();3==e?($(app.subscription.e.add.frequency).attr("disabled",!0),$(app.subscription.e.add.cycle).attr("disabled",!0),$(app.subscription.e.add.billing_type).attr("disabled",!0),$(app.subscription.e.add.frequency).val($(app.subscription.e.add.frequency).find("option:first").val()),$(app.subscription.e.add.cycle).val($(app.subscription.e.add.cycle).find("option:first").val()),$(app.subscription.e.add.billing_type).prop("checked",!1),$(app.subscription.e.add.form).find('input[name="expiry_date"]').val(""),$(app.subscription.e.add.form).find('input[name="expiry_date"]').closest(".form-group").hide(),$(app.subscription.e.add.billing_container).hide(),$(app.subscription.e.add.recurring).is(":checked")&&$(app.subscription.e.add.recurring_toggle).click(),$(app.subscription.e.add.recurring_toggle).css("pointer-events","none")):($(app.subscription.e.add.frequency).attr("disabled",!1),$(app.subscription.e.add.cycle).attr("disabled",!1),$(app.subscription.e.add.billing_type).attr("disabled",!1),$(app.subscription.e.add.form).find('input[name="expiry_date"]').closest(".form-group").show(),$(app.subscription.e.add.recurring_toggle).css("pointer-events",""),$(app.subscription.e.add.billing_container).show()),app.subscription.filter_alert_profile("#subscription_add_alert_id",e),app.subscription.modal_title_change("create"),app.subscription.create_recurring_check($("#subscription_add_recurring")[0])}create_quick_type_check(e){e=$(e).find(":selected").val();3==e?($(app.subscription.e.add_quick.frequency).attr("disabled",!0),$(app.subscription.e.add_quick.cycle).attr("disabled",!0),$(app.subscription.e.add.billing_type).attr("disabled",!0),$(app.subscription.e.add_quick.frequency).val($(app.subscription.e.add_quick.frequency).find("option:first").val()),$(app.subscription.e.add_quick.cycle).val($(app.subscription.e.add_quick.cycle).find("option:first").val()),$(app.subscription.e.add_quick.billing_type).prop("checked",!1),$(app.subscription.e.add_quick.billing_container).hide(),$(app.subscription.e.add_quick.recurring).is(":checked")&&$(app.subscription.e.add_quick.recurring_toggle).click(),$(app.subscription.e.add_quick.recurring_toggle).css("pointer-events","none")):($(app.subscription.e.add_quick.frequency).attr("disabled",!1),$(app.subscription.e.add_quick.cycle).attr("disabled",!1),$(app.subscription.e.add_quick.billing_type).attr("disabled",!1),$(app.subscription.e.add_quick.recurring_toggle).css("pointer-events",""),$(app.subscription.e.add_quick.billing_container).show()),app.subscription.filter_alert_profile("#main_quick_add_alert_id",e),app.subscription.modal_title_change("create_quick"),app.subscription.create_quick_recurring_check($("#main_quick_add_recurring")[0])}update_type_check(e){e=$(e).find(":selected").val();3==e?($(app.subscription.e.edit.frequency).attr("disabled",!0),$(app.subscription.e.edit.cycle).attr("disabled",!0),$(app.subscription.e.edit.billing_type).attr("disabled",!0),$(app.subscription.e.edit.frequency).val($(app.subscription.e.edit.frequency).find("option:first").val()),$(app.subscription.e.edit.cycle).val($(app.subscription.e.edit.cycle).find("option:first").val()),$(app.subscription.e.edit.billing_type).prop("checked",!1),$(app.subscription.e.edit.form).find('input[name="expiry_date"]').val(""),$(app.subscription.e.edit.form).find('input[name="expiry_date"]').closest(".form-group").hide(),$(app.subscription.e.edit.billing_container).hide(),$(app.subscription.e.edit.recurring_toggle).is(":checked")&&$(app.subscription.e.edit.recurring_toggle_container).click(),$(app.subscription.e.edit.recurring_toggle_container).css("pointer-events","none")):($(app.subscription.e.edit.frequency).attr("disabled",!1),$(app.subscription.e.edit.cycle).attr("disabled",!1),$(app.subscription.e.edit.billing_type).attr("disabled",!1),$(app.subscription.e.edit.form).find('input[name="expiry_date"]').closest(".form-group").show(),$(app.subscription.e.edit.recurring_toggle_container).css("pointer-events",""),$(app.subscription.e.edit.billing_container).show()),app.subscription.edit_recurring_check($(app.subscription.e.edit.recurring_toggle).get(0)),app.subscription.filter_alert_profile("#subscription_edit_alert_id",e),app.subscription.modal_title_change("update"),app.subscription.edit_recurring_check($("#subscription_edit_recurring_toggle")[0])}clone_type_check(e){e=$(e).find(":selected").val();3==e?($(app.subscription.e.clone.frequency).attr("disabled",!0),$(app.subscription.e.clone.cycle).attr("disabled",!0),$(app.subscription.e.clone.billing_type).attr("disabled",!0),$(app.subscription.e.clone.frequency).val($(app.subscription.e.clone.frequency).find("option:first").val()),$(app.subscription.e.clone.cycle).val($(app.subscription.e.clone.cycle).find("option:first").val()),$(app.subscription.e.clone.billing_type).prop("checked",!1),$(app.subscription.e.clone.form).find('input[name="expiry_date"]').val(""),$(app.subscription.e.clone.form).find('input[name="expiry_date"]').closest(".form-group").hide(),$(app.subscription.e.clone.billing_container).hide(),$(app.subscription.e.clone.recurring_toggle).is(":checked")&&$(app.subscription.e.clone.recurring_toggle_container).click(),$(app.subscription.e.clone.recurring_toggle_container).css("pointer-events","none")):($(app.subscription.e.clone.frequency).attr("disabled",!1),$(app.subscription.e.clone.cycle).attr("disabled",!1),$(app.subscription.e.clone.billing_type).attr("disabled",!1),$(app.subscription.e.clone.form).find('input[name="expiry_date"]').closest(".form-group").show(),$(app.subscription.e.clone.recurring_toggle_container).css("pointer-events",""),$(app.subscription.e.clone.billing_container).show()),app.subscription.clone_recurring_check($(app.subscription.e.clone.recurring_toggle).get(0)),app.subscription.filter_alert_profile("#subscription_clone_alert_id",e),app.subscription.modal_title_change("clone"),app.subscription.clone_recurring_check($("#subscription_clone_recurring_toggle")[0])}addon_type_check(e){e=$(e).find(":selected").val();3==e?($(app.subscription.e.addon.frequency).attr("disabled",!0),$(app.subscription.e.addon.cycle).attr("disabled",!0),$(app.subscription.e.addon.billing_type).attr("disabled",!0),$(app.subscription.e.addon.frequency).val($(app.subscription.e.addon.frequency).find("option:first").val()),$(app.subscription.e.addon.cycle).val($(app.subscription.e.addon.cycle).find("option:first").val()),$(app.subscription.e.addon.billing_type).prop("checked",!1),$(app.subscription.e.addon.form).find('input[name="expiry_date"]').val(""),$(app.subscription.e.addon.form).find('input[name="expiry_date"]').closest(".form-group").hide(),$(app.subscription.e.addon.billing_container).hide(),$(app.subscription.e.addon.recurring_toggle).is(":checked")&&$(app.subscription.e.addon.recurring_toggle_container).click(),$(app.subscription.e.addon.recurring_toggle_container).css("pointer-events","none")):($(app.subscription.e.addon.frequency).attr("disabled",!1),$(app.subscription.e.addon.cycle).attr("disabled",!1),$(app.subscription.e.addon.billing_type).attr("disabled",!1),$(app.subscription.e.addon.form).find('input[name="expiry_date"]').closest(".form-group").show(),$(app.subscription.e.addon.recurring_toggle_container).css("pointer-events",""),$(app.subscription.e.addon.billing_container).show()),app.subscription.addon_recurring_check($(app.subscription.e.addon.recurring_toggle).get(0)),app.subscription.filter_alert_profile("#subscription_addon_alert_id",e),app.subscription.modal_title_change("addon")}reset_type_fields(){$(app.subscription.e.add.frequency).attr("disabled",!1),$(app.subscription.e.add.cycle).attr("disabled",!1),$(app.subscription.e.add.recurring).attr("disabled",!1),$(app.subscription.e.add.billing_type).attr("disabled",!1),$(app.subscription.e.add.recurring_toggle).css("pointer-events",""),$(app.subscription.e.add.billing_container).show(),$(app.subscription.e.add.form).find('input[name="expiry_date"]').closest(".form-group").show(),$(app.subscription.e.add_quick.frequency).attr("disabled",!1),$(app.subscription.e.add_quick.cycle).attr("disabled",!1),$(app.subscription.e.add_quick.recurring).attr("disabled",!1),$(app.subscription.e.add_quick.billing_type).attr("disabled",!1),$(app.subscription.e.add_quick.recurring_toggle).css("pointer-events",""),$(app.subscription.e.add_quick.billing_container).show(),$(app.subscription.e.edit.frequency).attr("disabled",!1),$(app.subscription.e.edit.cycle).attr("disabled",!1),$(app.subscription.e.edit.recurring).attr("disabled",!1),$(app.subscription.e.edit.billing_type).attr("disabled",!1),$(app.subscription.e.edit.billing_container).show(),$(app.subscription.e.edit.form).find('input[name="expiry_date"]').closest(".form-group").show(),app.subscription.filter_alert_profile("#subscription_add_alert_id",1),app.subscription.filter_alert_profile("#main_quick_add_alert_id",1),app.subscription.filter_alert_profile("#subscription_edit_alert_id",1),app.subscription.filter_alert_profile("#subscription_clone_alert_id",1),setTimeout(function(){$("#subscription_add_alert_id").multiselect("refresh"),$("#main_quick_add_alert_id").multiselect("refresh"),$("#subscription_edit_alert_id").multiselect("refresh"),$("#subscription_clone_alert_id").multiselect("refresh")},1e3),$(app.subscription.e.clone.recurring_toggle_container).css("pointer-events",""),$("img.favicon").attr("src",app.config.favicon_url),app.subscription.modal_title_change("reset")}create_recurring_check(e){0==e.checked?($(app.subscription.e.add.frequency).attr("disabled",!0),$(app.subscription.e.add.cycle).attr("disabled",!0),$(app.subscription.e.add.billing_type).attr("disabled",!0),$(app.subscription.e.add.frequency).val($(app.subscription.e.add.frequency).find("option:first").val()),$(app.subscription.e.add.cycle).val($(app.subscription.e.add.cycle).find("option:first").val()),$(app.subscription.e.add.billing_type).prop("checked",!1)):($(app.subscription.e.add.frequency).attr("disabled",!1),$(app.subscription.e.add.cycle).attr("disabled",!1),$(app.subscription.e.add.billing_type).attr("disabled",!1)),lib.do.billing_toggle_switch(app.subscription.e.add.billing_type),app.subscription.modal_title_change("create")}create_quick_recurring_check(e){0==e.checked?($(app.subscription.e.add_quick.frequency).attr("disabled",!0),$(app.subscription.e.add_quick.cycle).attr("disabled",!0),$(app.subscription.e.add_quick.billing_type).attr("disabled",!0),$(app.subscription.e.add_quick.frequency).val($(app.subscription.e.add_quick.frequency).find("option:first").val()),$(app.subscription.e.add_quick.cycle).val($(app.subscription.e.add_quick.cycle).find("option:first").val()),$(app.subscription.e.add_quick.billing_type).prop("checked",!1)):($(app.subscription.e.add_quick.frequency).attr("disabled",!1),$(app.subscription.e.add_quick.cycle).attr("disabled",!1),$(app.subscription.e.add_quick.billing_type).attr("disabled",!1)),lib.do.billing_toggle_switch(app.subscription.e.add_quick.billing_type),app.subscription.modal_title_change("create_quick")}edit_recurring_check(e){0==e.checked?($(app.subscription.e.edit.frequency).attr("disabled",!0),$(app.subscription.e.edit.cycle).attr("disabled",!0),$(app.subscription.e.edit.billing_type).attr("disabled",!0),$(app.subscription.e.edit.frequency).val($(app.subscription.e.edit.frequency).find("option:first").val()),$(app.subscription.e.edit.cycle).val($(app.subscription.e.edit.cycle).find("option:first").val()),$(app.subscription.e.edit.billing_type).prop("checked",!1)):($(app.subscription.e.edit.frequency).attr("disabled",!1),$(app.subscription.e.edit.cycle).attr("disabled",!1),$(app.subscription.e.edit.billing_type).attr("disabled",!1)),lib.do.billing_toggle_switch(app.subscription.e.edit.billing_type),app.subscription.modal_title_change("update")}clone_recurring_check(e){0==e.checked?($(app.subscription.e.clone.frequency).attr("disabled",!0),$(app.subscription.e.clone.cycle).attr("disabled",!0),$(app.subscription.e.clone.billing_type).attr("disabled",!0),$(app.subscription.e.clone.frequency).val($(app.subscription.e.clone.frequency).find("option:first").val()),$(app.subscription.e.clone.cycle).val($(app.subscription.e.clone.cycle).find("option:first").val()),$(app.subscription.e.clone.billing_type).prop("checked",!1)):($(app.subscription.e.clone.frequency).attr("disabled",!1),$(app.subscription.e.clone.cycle).attr("disabled",!1),$(app.subscription.e.clone.billing_type).attr("disabled",!1)),lib.do.billing_toggle_switch(app.subscription.e.clone.billing_type),app.subscription.modal_title_change("clone")}addon_recurring_check(e){0==e.checked?($(app.subscription.e.addon.frequency).attr("disabled",!0),$(app.subscription.e.addon.cycle).attr("disabled",!0),$(app.subscription.e.addon.billing_type).attr("disabled",!0),$(app.subscription.e.addon.frequency).val($(app.subscription.e.addon.frequency).find("option:first").val()),$(app.subscription.e.addon.cycle).val($(app.subscription.e.addon.cycle).find("option:first").val()),$(app.subscription.e.addon.billing_type).prop("checked",!1)):($(app.subscription.e.addon.frequency).attr("disabled",!1),$(app.subscription.e.addon.cycle).attr("disabled",!1),$(app.subscription.e.addon.billing_type).attr("disabled",!1)),lib.do.billing_toggle_switch(app.subscription.e.addon.billing_type),app.subscription.modal_title_change("addon")}update_recurring_check(e){0==e.checked?($(app.subscription.e.edit.frequency).attr("disabled",!0),$(app.subscription.e.edit.cycle).attr("disabled",!0),$(app.subscription.e.edit.billing_type).attr("disabled",!0),$(app.subscription.e.edit.frequency).val($(app.subscription.e.edit.frequency).find("option:first").val()),$(app.subscription.e.edit.cycle).val($(app.subscription.e.edit.cycle).find("option:first").val()),$(app.subscription.e.edit.billing_type).prop("checked",!1)):($(app.subscription.e.edit.frequency).attr("disabled",!1),$(app.subscription.e.edit.cycle).attr("disabled",!1),$(app.subscription.e.edit.billing_type).attr("disabled",!1)),app.subscription.modal_title_change("update")}load_page(){"calendar"==app.page.get_slug()?app.page.switch("calendar"):$("#tbl_subscription").DataTable().ajax.reload(null,!1)}load_chart(i,e){var t=new FormData;t.append("_token",app.config.token),t.append("type",i),t.append("days",e),$.ajax({url:app.url+"subscription/chart",type:"POST",data:t,dataType:"json",beforeSend:function(e){},success:function(e){e.status?(1==i?app.subscription.o.subscription.chart.data=e.data.subs_chart:3==i&&(app.subscription.o.lifetime.chart.data=e.data.ltd_chart),app.subscription.render_chart(i)):app.alert.validation(e.message)},error:function(e){app.alert.response(e)},complete:function(){},processData:!1,contentType:!1})}render_chart(e){}koolreport_chart_load(e,i){var t;1==e?((t=new FormData).append("_token",app.config.token),t.append("type",e),t.append("days",i),$.ajax({url:app.url+"subscription/koolreport/area_chart",type:"POST",data:t,dataType:"json",beforeSend:function(e){},success:function(e){app.subscription.set_chart_data(1,e)},error:function(e){app.alert.response(e)},complete:function(){},processData:!1,contentType:!1})):3==e?((t=new FormData).append("_token",app.config.token),t.append("type",e),t.append("days",i),$.ajax({url:app.url+"subscription/koolreport/lifetime_drilldown_chart_all_time",type:"POST",data:t,dataType:"json",beforeSend:function(e){},success:function(e){app.subscription.set_chart_data(3,e)},error:function(e){app.alert.response(e)},complete:function(){},processData:!1,contentType:!1})):((t=new FormData).append("_token",app.config.token),t.append("type",e),t.append("days",i),$.ajax({url:app.url+"subscription/koolreport/area_chart",type:"POST",data:t,dataType:"json",beforeSend:function(e){},success:function(e){app.subscription.set_chart_data(1,e)},error:function(e){app.alert.response(e)},complete:function(){},processData:!1,contentType:!1}))}set_chart_data(e,i){1==e?($(app.subscription.e.chart.subscription_total_count).text(i.subscription.total_count),$(app.subscription.e.chart.subscription_active_count).text(i.subscription.total_count),$(app.subscription.e.chart.subscription_monthly_price).text("$"+i.subscription.monthly_price),$(app.subscription.e.chart.subscription_total_price).text("$"+i.subscription.total_price),$(app.subscription.e.koolreport.area_chart).html(i.subscription.chart_html)):3==e&&($(app.subscription.e.chart.lifetime_total_count).text(i.lifetime.total_count),$(app.subscription.e.chart.lifetime_active_count).text(i.lifetime.total_count),$(app.subscription.e.chart.lifetime_this_year_price).text("$"+i.lifetime.this_year_price),$(app.subscription.e.chart.lifetime_total_price).text("$"+i.lifetime.total_price),$(app.subscription.e.koolreport.drilldown).html(i.lifetime.chart_html))}modal_title_change(e){switch(e){case"create":var i=$("#subscription_add_type").find(":selected").text();(t=$("#subscription_add_brand_id").children("option:selected").text())?i?$("#modal_subscription_add_title").text(lang("Add")+" "+t+" "+i):$("#modal_subscription_add_title").text(lang("Add")+" "+t):$("#modal_subscription_add_title").text(lang("Add Subscription"));break;case"create_quick":i=$("#main_quick_add_type").find(":selected").text();(t=$("#main_quick_add_brand_id").children("option:selected").text())?i?$("#modal_subscription_quick_add_title").text(lang("Add")+" "+t+" "+i):$("#modal_subscription_quick_add_title").text(lang("Add")+" "+t):$("#modal_subscription_quick_add_title").text(lang("Add Subscription (Quick)"));break;case"update":i=$("#subscription_edit_type").find(":selected").text();(t=$("#subscription_edit_brand_id").children("option:selected").text())?i?$("#modal_subscription_edit_title").text(lang("Update")+" "+t+" "+i):$("#modal_subscription_edit_title").text(lang("Update")+" "+t):$("#modal_subscription_edit_title").text(lang("Subscription Update"));break;case"clone":i=$("#subscription_clone_type").find(":selected").text();(t=$("#subscription_clone_brand_id").children("option:selected").text())?i?$("#modal_subscription_clone_title").text(lang("Clone")+" "+t+" "+i):$("#modal_subscription_clone_title").text(lang("Clone")+" "+t):$("#modal_subscription_clone_title").text(lang("Subscription Clone"));break;case"addon":var t,i=$("#subscription_addon_type").find(":selected").text();(t=$("#subscription_addon_brand_id").children("option:selected").text())?i?$("#modal_subscription_addon_title").text(lang("Addon for")+" "+t+" "+i):$("#modal_subscription_addon_title").text(lang("Addon for")+" "+t):$("#modal_subscription_addon_title").text(lang("Lifetime Addon"));break;default:return $("#modal_subscription_add_title").text(lang("Add Subscription")),$("#modal_subscription_quick_add_title").text(lang("Add Subscription (Quick)")),$("#modal_subscription_edit_title").text(lang("Subscription Update")),$("#modal_subscription_clone_title").text(lang("Subscription Clone")),$("#modal_subscription_addon_title").text(lang("Lifetime Addon")),!1}}update_popup_refund(e){e=$(e).closest(".modal").find('form input[name="id"]');if(!e.length)return!1;app.subscription.refund(e.val())}update_popup_clone(e){e=$(e).closest(".modal").find('form input[name="id"]');if(!e.length)return!1;$("#modal_subscription_edit").modal("hide"),app.subscription.clone(e.val())}update_popup_delete(e){e=$(e).closest(".modal").find('form input[name="id"]');if(!e.length)return!1;app.subscription.delete(e.val())}update_popup_cancel(e){e=$(e).closest(".modal").find('form input[name="id"]');if(!e.length)return!1;app.subscription.cancel(e.val())}update_popup_addon(e){e=$(e).closest(".modal").find('form input[name="id"]');if(!e.length)return!1;$("#modal_subscription_edit").modal("hide"),app.subscription.addon(e.val())}set_datatable_page_length(e){var i=new FormData;i.append("_token",app.config.token),i.append("length",e),$.ajax({url:app.url+"subscription/session/set_datatable_page_length",type:"POST",data:i,dataType:"json",beforeSend:function(e){},success:function(e){},error:function(e){app.alert.response(e)},complete:function(){},processData:!1,contentType:!1})}koolreport_both_charts_load(){var e;"/user/email/verify"!=window.location.pathname&&((e=new FormData).append("_token",app.config.token),$.ajax({url:app.url+"subscription/koolreport/both_charts",type:"POST",data:e,dataType:"json",beforeSend:function(e){},success:function(e){app.subscription.set_chart_data(1,e),app.subscription.set_chart_data(3,e)},error:function(e){app.alert.response(e)},complete:function(){},processData:!1,contentType:!1}))}load_lifetime_drilldown_chart(e,i,t=null){var a=new FormData;a.append("_token",app.config.token),a.append("level",e),a.append("year",i),a.append("month_name",t),app.subscription.o.ajax.current_request=$.ajax({url:app.url+"subscription/koolreport/lifetime_drilldown_chart_inside",type:"POST",data:a,dataType:"json",beforeSend:function(e){null!=app.subscription.o.ajax.current_request&&app.subscription.o.ajax.current_request.abort()},success:function(e){$(app.subscription.e.koolreport.drilldown).html(e.html)},error:function(e){},complete:function(){app.loading.unblock(app.subscription.e.chart.container)},processData:!1,contentType:!1})}history(i){var e=lib.get_id(i);if(!e)return!1;var t=new FormData;t.append("_token",app.config.token),t.append("id",e),$.ajax({url:app.url+"subscription/history/"+e,type:"POST",data:t,beforeSend:function(e){app.loading.btn(i)},success:function(e){e&&($("#modal_subscription_history .modal-content").html(e),$("#modal_subscription_history").modal(),app.load.tooltip())},error:function(e){app.alert.response(e)},complete:function(){app.loading.btn(i)},processData:!1,contentType:!1})}}